<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    
    
    
    

    
    <title>Notion2Hugo blog 자동화</title>
    <meta name="description" content="Interested in ML Engineering, Data Science.">
    <meta name="keywords" content='blog, gokarna, hugo, Github Blog, Hugo, Latex, Notion'>

    <meta property="og:url" content="https://osmin625.github.io/posts/notion-to-hugo-blog-%EC%9E%90%EB%8F%99%ED%99%94/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Notion2Hugo blog 자동화">
    <meta property="og:description" content="Interested in ML Engineering, Data Science.">
    <meta property="og:image" content="https://osmin625.github.io/images/from_scratch.webp">
    <meta property="og:image:secure_url" content="https://osmin625.github.io/images/from_scratch.webp">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Notion2Hugo blog 자동화">
    <meta name="twitter:description" content="Interested in ML Engineering, Data Science.">
    <meta property="twitter:domain" content="https://osmin625.github.io/posts/notion-to-hugo-blog-%EC%9E%90%EB%8F%99%ED%99%94/">
    <meta property="twitter:url" content="https://osmin625.github.io/posts/notion-to-hugo-blog-%EC%9E%90%EB%8F%99%ED%99%94/">
    <meta name="twitter:image" content="https://osmin625.github.io/images/from_scratch.webp">

    
    <link rel="canonical" href="https://osmin625.github.io/posts/notion-to-hugo-blog-%EC%9E%90%EB%8F%99%ED%99%94/" />

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.4ffdc838c15e2e2971b91a99fe21b6cfe58ddb8410dd0e3487b6b9b92cc3caaa.js" integrity="sha256-T/3IOMFeLilxuRqZ/iG2z&#43;WN24QQ3Q40h7a5uSzDyqo="></script>

    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
            
            const sessionId = getSessionId();
            console.log('현재 세션 ID:', sessionId);
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://osmin625.github.io">
                <img src='/images/from_scratch.webp' alt="OMIN" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://osmin625.github.io">오뚝이 개발자</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://osmin625.github.io/"><span data-feather='home'></span> Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://osmin625.github.io/categories/"><span data-feather='list'></span> Categories </a>
            </div>
            
            <div class="nav-link">
                <a href="https://osmin625.github.io/tags/"><span data-feather='tag'></span> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://osmin625.github.io/posts/"><span data-feather='book'></span> archive </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://osmin625.github.io/"><span data-feather='home'></span> Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://osmin625.github.io/categories/"><span data-feather='list'></span> Categories </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://osmin625.github.io/tags/"><span data-feather='tag'></span> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://osmin625.github.io/posts/"><span data-feather='book'></span> archive </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Notion2Hugo blog 자동화</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">3월 18, 2024
        
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://osmin625.github.io/tags/Github-Blog">Github Blog</a></li>
        
            <li class="post-tag"><a href="https://osmin625.github.io/tags/Hugo">Hugo</a></li>
        
            <li class="post-tag"><a href="https://osmin625.github.io/tags/Latex">Latex</a></li>
        
            <li class="post-tag"><a href="https://osmin625.github.io/tags/Notion">Notion</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p>나는 노션을 꽤 오래 전부터 사용해왔다.</p>
<p>공부하며 노션에 기록하는 것이 습관화되어 있는데, 이렇게 정리해 둔 게시글만 500개가 넘는다.</p>
<p>애초부터 노션에 정리해 둔 글을 보다 쉽게 블로그에 업로드하고자 호환성이 좋은 깃허브 블로그를 사용하고 있으나, 학습 내용을 기록하는 공간이 두 개로 구분되었을 때 둘 모두를 관리하는 건 생각보다 쉽지 않다는 것을 깨달았다.</p>
<p>아무튼, 이번에는 Hugo 블로그에 Notion에서 작성한 게시글을 보다 쉽게 업로드하기 위해 자동화를 시도해보았다.</p>
<ul>
<li>
<p>기존에는 post 작성을 끝낸 후 build하고 push하는 과정을 쉘 커맨드로 간편하게 구성해두었다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>echo -e <span style="color:#e6db74">&#34;\033[0;32mDeploying updates to GitHub...\033[0m&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Build the project.</span>
</span></span><span style="display:flex;"><span>hugo -t gokarna
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Go To Public folder</span>
</span></span><span style="display:flex;"><span>cd public
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Add changes to git.</span>
</span></span><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Commit changes.</span>
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rebuilding site `date`&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $# -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">then</span> msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#e6db74">&#34;</span>$msg<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Push source and build repos.</span>
</span></span><span style="display:flex;"><span>git push origin main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Come Back up to the Project Root</span>
</span></span><span style="display:flex;"><span>cd ..
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># blog 저장소 Commit &amp; Push</span>
</span></span><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rebuilding site `date`&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $# -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">then</span> msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#e6db74">&#34;</span>$msg<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>git push origin main
</span></span></code></pre></div></li>
</ul>
<p>이조차도 번거로워 이제는 노션 게시글 압축 파일을 압축 풀고 페이지를 적절하게 수정하여 업로드하는 과정을 자동화하고자 한다.</p>
<p>…</p>
<p>처음에는 간단하게 구상했으나 동작을 구현할수록 점점 더 욕심이 생겨서 차라리 개선 사항에 대해 버저닝을 하더라도 먼저 업로드 하기로 결심했다.</p>
<h2 id="구현-과정">구현 과정</h2>
<p>나의 목표는 노션에서 <code>내보내기</code> 버튼을 클릭한 후, 이외의 모든 작업을 딸깍 한 번으로 자동화하는 것이었다.</p>
<p>이를 자동화하기 위해서는 다음과 같은 작업들을 코드로 수행해야 한다.</p>
<ol>
<li>download 폴더에 저장된 노션 페이지 압축 파일을 압축 해제하기</li>
<li>파일 명과 이미지 파일의 이름을 수정하기</li>
<li>frontmatter 추가하기</li>
<li>latex 문법 수정하기</li>
<li>notion image 링크 블로그 디렉토리에 알맞게 갱신하기</li>
<li>처리된 파일들을 블로그의 각 디렉토리에 적절히 이동시키기.</li>
</ol>
<p>대략 나열했는데 노션과 깃허브 블로그를 함께 운영해본 사람이라면 공감할 반복 작업들이다.</p>
<p>위의 작업 단위를 그대로 함수로 구현했다.</p>
<h2 id="코드">코드</h2>
<h3 id="1-노션-압축-파일-목록-생성하기">1. 노션 압축 파일 목록 생성하기</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getZipList</span>(downloadPath):
</span></span><span style="display:flex;"><span>    dwPathFiles <span style="color:#f92672">=</span> listdir(downloadPath)
</span></span><span style="display:flex;"><span>    zips_ <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> dwPathFiles:
</span></span><span style="display:flex;"><span>        filePath <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(downloadPath,f)
</span></span><span style="display:flex;"><span>        fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(f)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.zip&#39;</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;Export&#39;</span> <span style="color:#f92672">in</span> fname:
</span></span><span style="display:flex;"><span>            zips_<span style="color:#f92672">.</span>append(filePath)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> zips_
</span></span></code></pre></div><p>코드에서 보이는 것처럼 노션에서 내보내기를 통해 저장하면 기본적으로 Export가 압축 파일 명에 포함된다는 사실을 이용했다.</p>
<p>따라서 현재 코드에서는 압축 파일 명을 바꾸거나 노션에서 해당 부분의 default 설정이 바뀌게 되는 경우 제대로 동작하지 않는다.</p>
<h3 id="2-압축-풀기">2. 압축 풀기</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extractZip</span>(path_ <span style="color:#f92672">=</span> downloadPath):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> path<span style="color:#f92672">.</span>isdir(sourcePath): 
</span></span><span style="display:flex;"><span>        makedirs(sourcePath)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> zf <span style="color:#f92672">in</span> getZipList(path_):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> zipfile<span style="color:#f92672">.</span>ZipFile(zf, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> zipRef:
</span></span><span style="display:flex;"><span>            zipRef<span style="color:#f92672">.</span>extractall(sourcePath)
</span></span></code></pre></div><p>압축 풀기 함수에서 <code>getZipList</code> 함수를 호출한다.</p>
<p>키워드 파라미터로 download를 default로 설정해두었다.</p>
<h3 id="3-압축-푼-파일-이름-다른-형식ex-pdf-파일-제거하기">3. 압축 푼 파일 이름, 다른 형식(ex. pdf) 파일 제거하기</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">organizeNotionExportFile</span>(path_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>        fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ext <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;.md&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>]:
</span></span><span style="display:flex;"><span>            remove(path<span style="color:#f92672">.</span>join(path_, file))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> ext <span style="color:#f92672">and</span> fname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.md&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>            shutil<span style="color:#f92672">.</span>rmtree(path<span style="color:#f92672">.</span>join(path_, fname))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(fname<span style="color:#f92672">.</span>split()[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        new_file <span style="color:#f92672">=</span> fname <span style="color:#f92672">+</span> ext
</span></span><span style="display:flex;"><span>        rename(path<span style="color:#f92672">.</span>join(path_,file), path<span style="color:#f92672">.</span>join(path_, new_file))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> listdir(path_)
</span></span></code></pre></div><p>노션으로 내보내기를 수행해 본 사람은 알겠지만 파일 명에 default로 page id가 붙어있다.</p>
<p>그래서 파일명이 <code>Entropy(엔트로피) 8c9f84e2a61d4bedb289546cd9f2e782.md</code> 처럼 매우 지저분하기 때문에, 공백을 기준으로 구분하여 이 부분을 제거해주었다.</p>
<p>이외에도 pdf 파일이나 html 파일로 잘못 내보내기가 된 경우 (혹은 다른 목적으로 내보내기 한 압축 파일의 경우) 제외했다.</p>
<p>디렉토리를 제거하기 위해서는 <code>os.remove</code>가 아닌, <code>shutil</code>이라는 모듈의 <code>rmtree</code>를 활용해야 했다.</p>
<h3 id="4-파일명-기분-좋게-수정하기">4. 파일명 기분 좋게(?) 수정하기</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cleanFileNames</span>(path_):
</span></span><span style="display:flex;"><span>    pattern <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;[^\w\d_]+&#39;</span>)
</span></span><span style="display:flex;"><span>    renameCount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>        fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>        fname <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(pattern, <span style="color:#e6db74">&#39;_&#39;</span>, fname)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> fname<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;_&#39;</span>):
</span></span><span style="display:flex;"><span>            fname <span style="color:#f92672">=</span> fname<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;_&#39;</span>)
</span></span><span style="display:flex;"><span>        rename(path<span style="color:#f92672">.</span>join(path_, file), path<span style="color:#f92672">.</span>join(path_, fname <span style="color:#f92672">+</span> ext))
</span></span><span style="display:flex;"><span>        renameCount <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>renameCount<span style="color:#e6db74">}</span><span style="color:#e6db74"> files name successfully changed]&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> renameCount
</span></span></code></pre></div><p>파일명에서 page id를 제거했지만, 여전히 띄어쓰기, 대괄호 등이 파일명에 존재하기 때문에 파일명으로는 불안하다.</p>
<p>사실 위의 함수에서 한 번에 처리할까 고민하다가 따로 구분했다.</p>
<p>안정감을 위해 공백과 괄호를 언더바로 바꾸고, 파일 끝에 오는 언더바는 또 마음이 불편하니 제거해주었다.</p>
<h3 id="5-이미지-파일-이름-수정하기">5. 이미지 파일 이름 수정하기</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">updateImageFileName</span>(path_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_updateImageFileName</span>(path_, folder_name):
</span></span><span style="display:flex;"><span>        path_ <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(path_, folder_name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, img <span style="color:#f92672">in</span> enumerate(listdir(path_)):
</span></span><span style="display:flex;"><span>            rename(path<span style="color:#f92672">.</span>join(path_, img), path<span style="color:#f92672">.</span>join(path_, folder_name <span style="color:#f92672">+</span> str(i) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>))
</span></span><span style="display:flex;"><span>        logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> Images Name Changed] </span><span style="color:#e6db74">{</span>img<span style="color:#e6db74">}</span><span style="color:#e6db74"> -&gt; </span><span style="color:#e6db74">{</span>folder_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>isdir(path<span style="color:#f92672">.</span>join(path_, file)):
</span></span><span style="display:flex;"><span>            _updateImageFileName(path_, file)
</span></span></code></pre></div><p>노션 페이지에 포함된 이미지 파일들은 따로 폴더에 저장되는데, 모두 Untitled라는 성의없는 이름으로 저장된다.</p>
<p>이는 나중에 페이지 내에서 해당 이미지를 링크할 때에도 불편해지기 때문에 이미지 파일명을 예뻐진 파일명으로 갱신해주는 작업이다.</p>
<p>코드 가독성을 위해 핵심 기능은 중첩 함수로 따로 구분했다.</p>
<p>logging 모듈을 이용하여 동작 과정에서의 이슈를 추적하도록 구성했다.</p>
<h3 id="6-페이지-내부-작업">6. 페이지 내부 작업</h3>
<ul>
<li>
<p><strong>md 파일 내의 이미지 경로를 수정하기 위한 image 파일 경로 기록</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>isdir(path<span style="color:#f92672">.</span>join(path_,fname)):
</span></span><span style="display:flex;"><span>    imgList <span style="color:#f92672">=</span> [imgFile <span style="color:#66d9ef">for</span> imgFile <span style="color:#f92672">in</span> listdir(path<span style="color:#f92672">.</span>join(path_,fname))]
</span></span><span style="display:flex;"><span>    imgIdx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div></li>
<li>
<p><strong>이미지 경로 갱신하기</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;![Untitled](&#39;</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>    indent_ <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;![Untitled]&#39;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>indent_<span style="color:#e6db74">}</span><span style="color:#e6db74">![</span><span style="color:#e6db74">{</span>fname<span style="color:#e6db74">}</span><span style="color:#e6db74">](/imgs/</span><span style="color:#e6db74">{</span>imgList[imgIdx]<span style="color:#e6db74">}</span><span style="color:#e6db74">)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    imgIdx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>파일 명이 길어지는 경우 해당 부분에서 예외 케이스가 발생하는 것을 확인했다.</p>
<p>처음에는 re 문법으로 <code>![~~](~~)</code> 형태를 탐색하여 해당 문자열을 재구성했었다.</p>
<p>하지만 <code>![~~](~~(~~~)~)</code> 처럼 소괄호가 중첩으로 발생하는 경우가 있어 위의 방식으로 간단하게 구현했다.</p>
</li>
<li>
<p><strong>블로그 포스팅 md 파일에 필요한 Frontmatter을 추가하는 동작</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> f<span style="color:#f92672">.</span>isfirstline():
</span></span><span style="display:flex;"><span>    title <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74">&#39;#&#39;</span>)
</span></span><span style="display:flex;"><span>    titleParam <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;title:&#39;</span> <span style="color:#f92672">+</span> title
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;---&#39;</span>)
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> titleParam
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> FrontMatterClosed:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> line <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> f<span style="color:#f92672">.</span>lineno() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>        FrontMatterClosed <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;type: post&#39;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;---&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> paramCheck:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> paramCheck[p]:
</span></span><span style="display:flex;"><span>                logging<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">] The [</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">] parameter does not exist in the frontmatter of the post.&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 노션 DB에 존재하는 column들</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> line<span style="color:#f92672">.</span>startswith((<span style="color:#e6db74">&#39;마지막 학습일:&#39;</span>, <span style="color:#e6db74">&#39;status:&#39;</span>, <span style="color:#e6db74">&#39;갱신:&#39;</span>, 
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#39;summary:&#39;</span>, <span style="color:#e6db74">&#39;생성일:&#39;</span>, <span style="color:#e6db74">&#39;생성일0:&#39;</span>, 
</span></span><span style="display:flex;"><span>                          <span style="color:#e6db74">&#39;하위 항목:&#39;</span>, <span style="color:#e6db74">&#39;상위 항목:&#39;</span>, <span style="color:#e6db74">&#39;이웃 항목:&#39;</span>)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 나는 편의를 위해 노션 DB에 categories, tags column을 만들어두었다.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> line<span style="color:#f92672">.</span>startswith((<span style="color:#e6db74">&#39;categories:&#39;</span>, <span style="color:#e6db74">&#39;tags:&#39;</span>)):
</span></span><span style="display:flex;"><span>        param, values <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;:&#39;</span>)
</span></span><span style="display:flex;"><span>        values <span style="color:#f92672">=</span> values<span style="color:#f92672">.</span>lstrip()<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        line <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>param<span style="color:#e6db74">}</span><span style="color:#e6db74">: [</span><span style="color:#e6db74">{</span>values<span style="color:#e6db74">}</span><span style="color:#e6db74">]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span></code></pre></div><p>노션 페이지를 내보내기하면 페이지 속성이 <code>attr:value</code> 형식으로 md 파일 상단에 적히게 되는데, 해당 값을 재활용하여 Frontmatter로 작성한다.</p>
<p>즉, 나는 편의를 위해 노션 페이지에 date, categories, tags 등의 속성을 추가해두었다.</p>
<p>Frontmatter에서의 이슈는 Frontmatter를 언제 닫아야 할 지 결정하는 것이었다.</p>
<p>단순히 시작 이후 공백 발생 시 Frontmatter를 닫도록 했더니 예외 케이스가 발생하여 결국</p>
<p><code>elif f.lineno() &gt; 2 and ':' not in line</code> , 즉 3 번째 줄 이상이고 :가 처음으로 포함되지 않을 때 Frontmatter을 닫도록 구성했다.</p>
<p>닫기 전에 categories나 tags 등 노션 페이지에서 넘어오는 파라미터가 없는 경우에 대한 로깅을 추가했다.</p>
</li>
<li>
<p><strong>latex 수식 오류 로그 발생시키기</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;⁍&#39;</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>    logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">] </span><span style="color:#e6db74">{</span>f<span style="color:#f92672">.</span>lineno()<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">th line latex syntax error occured.&#39;</span>)
</span></span></code></pre></div><p>가끔씩 latex 문법에서 오류가 발생하여 $⁍$ 기호로 변경되는 경우가 종종 있다.</p>
<p>기호를 검색해보니 <code>Black Rightwards Bullet</code>이라고 부르던데, 이상하게도 수식 오류 발생 시 항상 해당 기호로 변경되기 때문에 조건문에서 활용한다.</p>
<p>아마 유니코드와 관련된 문제가 아닐까 짐작된다. 굳이 찾아보진 않았다.</p>
</li>
<li>
<p><strong>latex 수식 블로그 문법에 맞게 수정하기</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;$$&#39;</span> <span style="color:#f92672">in</span> line <span style="color:#f92672">and</span> len(line<span style="color:#f92672">.</span>lstrip()) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">3</span>: <span style="color:#75715e"># 블럭 수식</span>
</span></span><span style="display:flex;"><span>    indent_ <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;$$&#39;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> insideOfLatexBlock:
</span></span><span style="display:flex;"><span>        line <span style="color:#f92672">=</span> indent_ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;`$$</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>        insideOfLatexBlock <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        line <span style="color:#f92672">=</span> indent_ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;$$`</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>        insideOfLatexBlock <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;$&#39;</span> <span style="color:#f92672">in</span> line <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;`$&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> line <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;$`&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> line: <span style="color:#75715e"># 인라인 수식</span>
</span></span><span style="display:flex;"><span>    tokens <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;$&#39;</span>)
</span></span><span style="display:flex;"><span>    insideOfLatexInline <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(tokens) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>: <span style="color:#75715e"># token들이 하나의 문장으로 합쳐질 때까지 반복.</span>
</span></span><span style="display:flex;"><span>        right_, left_ <span style="color:#f92672">=</span> tokens<span style="color:#f92672">.</span>pop(), tokens<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> insideOfLatexInline:
</span></span><span style="display:flex;"><span>            tokens<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>left_<span style="color:#e6db74">}</span><span style="color:#e6db74">$`</span><span style="color:#e6db74">{</span>right_<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>            insideOfLatexInline <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            tokens<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>left_<span style="color:#e6db74">}</span><span style="color:#e6db74">`$</span><span style="color:#e6db74">{</span>right_<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>            insideOfLatexInline <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> tokens<span style="color:#f92672">.</span>pop()
</span></span></code></pre></div><p>사실 이 부분은 내 블로그에 한정된 이야기인데, 나는 블로그의 latex 문법 변환 과정을 최적화하기 위해 latex 수식을 코드 블럭으로 감싼다.</p>
<p>굳이 설명을 하자면 블럭 수식의 경우</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-latex" data-lang="latex"><span style="display:flex;"><span><span style="color:#e6db74">$$</span>
</span></span><span style="display:flex;"><span>H<span style="color:#f92672">(</span>X<span style="color:#f92672">)=</span>\sum_{i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>}^n p_i\left<span style="color:#f92672">(</span>\log \frac{<span style="color:#ae81ff">1</span>}{p_i}\right<span style="color:#f92672">)=-</span>\sum_{i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>}^n p_i \log p_i
</span></span><span style="display:flex;"><span><span style="color:#e6db74">$$</span>
</span></span></code></pre></div><p>이렇게 생겼고, 인라인 수식의 경우</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-latex" data-lang="latex"><span style="display:flex;"><span>왈왈공자왈<span style="color:#e6db74">$</span><span style="color:#f92672">(</span>p_i<span style="color:#f92672">)</span><span style="color:#e6db74">$</span>왈아무말왈<span style="color:#e6db74">$</span><span style="color:#f92672">(-</span>\log_<span style="color:#ae81ff">2</span><span style="color:#f92672">(</span>p_i<span style="color:#f92672">))</span><span style="color:#e6db74">$</span>말말말
</span></span></code></pre></div><p>이렇게 생겼다.</p>
<p>블럭 수식의 경우 latex 식별 기호가 줄바꿈이 반드시 따라온다는 점을 이용해 기호 포함 여부와 문장 길이로 구분했다.</p>
<p>기호 포함 여부만 활용하는 경우 인라인 수식 두 개가 연달아 적히는 경우 블럭 수식으로 인식해버리기 때문에 길이에 대한 조건이 추가로 필요하다.</p>
<p>인라인 수식의 경우 구분자를 기준으로 split한 다음, 하나씩 새로운 구분자로 이어붙이는 코드를 구현했다.</p>
<p>최종적으로 모든 토큰이 하나의 문장으로 이어지면 동작이 종료하도록 구현했다.</p>
</li>
</ul>
<p>사실 생각한 것보다 해당 함수가 너무 묵직해져서 작은 작업 단위로 구분하기 위해 호시탐탐 노려보고 있다.</p>
<p>다만 함수 내에서 파일 포인터를 활용하고 있어 이 부분을 함수로 빼냈을 때 어떻게 동작할 지 알아보기 위해 일단 보류해두었다.</p>
<p>해당 부분을 학습한 이후 포스팅을 할까 고민도 했으나, 포스팅이 또 밀릴 것 같아 차후에 따로 업데이트된 코드를 업로드하기로 했다.</p>
<p>최근에 로버트 아저씨의 클린 코드 책을 감명 깊게 읽어 주석을 최소화하자는 생각을 가지고 있으나, 아직은 코드의 깔끔함이 그 정도는 아니라고 생각해 변명을 적는 마음으로 코드에 주석을 달았다.</p>
<p>특히 인라인 latex를 처리하는 구문은 코드 직관성이 매우 떨어진다고 생각한다. 조금 더 고민할 필요가 있다.</p>
<h3 id="7-파일-이동시키기">7. 파일 이동시키기</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">move_md_</span>(fname, path_, src_path <span style="color:#f92672">=</span> sourcePath):
</span></span><span style="display:flex;"><span>    src <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(src_path, fname)
</span></span><span style="display:flex;"><span>    dest <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(path_, fname)
</span></span><span style="display:flex;"><span>    rename(src, dest)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fileDistribute</span>(path_):
</span></span><span style="display:flex;"><span>    fname_md, fname_dir <span style="color:#f92672">=</span> set(), set()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_fileDistribute</span>(path_):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>            fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.md&#39;</span>:
</span></span><span style="display:flex;"><span>                fname_md<span style="color:#f92672">.</span>add(fname)
</span></span><span style="display:flex;"><span>                move_md_(file, contentPath)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.png&#39;</span>:
</span></span><span style="display:flex;"><span>                move_md_(file, imgPath, path_)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>                fname_dir<span style="color:#f92672">.</span>add(fname)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                remove(path<span style="color:#f92672">.</span>join(path_, file))
</span></span><span style="display:flex;"><span>    _fileDistribute(path_)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mdImgDir <span style="color:#f92672">=</span> fname_dir <span style="color:#f92672">&amp;</span> fname_md
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> fname_md <span style="color:#f92672">in</span> mdImgDir:
</span></span><span style="display:flex;"><span>        _fileDistribute(path<span style="color:#f92672">.</span>join(path_, fname_md))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    shutil<span style="color:#f92672">.</span>rmtree(sourcePath)
</span></span></code></pre></div><p>마찬가지로 코드의 중복을 최소화하기 위해 중첩 함수 구조를 활용했다.</p>
<p>실제 스크립트에서는 파라미터를 통해 distribute 동작이 실행되기 전에 draft 폴더에서 업로드 할 파일들을 한 눈에 볼 수 있도록 구성했다.</p>
<h3 id="전체-코드">전체 코드</h3>
<p>결론적으로 전체 코드는 다음과 같다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> path, listdir, makedirs, rename, remove, getenv
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> zipfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> fileinput
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> argparse <span style="color:#f92672">import</span> ArgumentParser
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parser <span style="color:#f92672">=</span> ArgumentParser()
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-a&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39; : Running whole functions include fileDistribute when executing the script.&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-d&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39; : Running the distribute function only.&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post_upload.log&#34;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>, level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>userName <span style="color:#f92672">=</span> getenv(<span style="color:#e6db74">&#39;username&#39;</span>)
</span></span><span style="display:flex;"><span>downloadPath <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Users&#39;</span>,userName,<span style="color:#e6db74">&#39;Downloads&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 본인의 post 경로</span>
</span></span><span style="display:flex;"><span>contentPath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Users</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Ohseungmin</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">workspace</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">blog</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">frontend</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">content</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">posts&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 본인의 image 저장 경로</span>
</span></span><span style="display:flex;"><span>imgPath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Users</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">Ohseungmin</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">workspace</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">blog</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">frontend</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">static</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">imgs&#39;</span> 
</span></span><span style="display:flex;"><span>currentPath <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>curdir
</span></span><span style="display:flex;"><span>sourcePath <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(currentPath, <span style="color:#e6db74">&#39;draft_files&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getZipList</span>(downloadPath):
</span></span><span style="display:flex;"><span>    dwPathFiles <span style="color:#f92672">=</span> listdir(downloadPath)
</span></span><span style="display:flex;"><span>    zips_ <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> dwPathFiles:
</span></span><span style="display:flex;"><span>        filePath <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(downloadPath,f)
</span></span><span style="display:flex;"><span>        fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(f)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.zip&#39;</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;Export&#39;</span> <span style="color:#f92672">in</span> fname:
</span></span><span style="display:flex;"><span>            zips_<span style="color:#f92672">.</span>append(filePath)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> zips_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extractZip</span>(path_ <span style="color:#f92672">=</span> downloadPath):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> path<span style="color:#f92672">.</span>isdir(sourcePath): 
</span></span><span style="display:flex;"><span>        makedirs(sourcePath)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> zf <span style="color:#f92672">in</span> getZipList(path_):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> zipfile<span style="color:#f92672">.</span>ZipFile(zf, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> zipRef:
</span></span><span style="display:flex;"><span>            zipRef<span style="color:#f92672">.</span>extractall(sourcePath)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">move_md_</span>(fname, path_, src_path <span style="color:#f92672">=</span> sourcePath):
</span></span><span style="display:flex;"><span>    src <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(src_path, fname)
</span></span><span style="display:flex;"><span>    dest <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(path_, fname)
</span></span><span style="display:flex;"><span>    rename(src, dest)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fileDistribute</span>(path_):
</span></span><span style="display:flex;"><span>    fname_md, fname_dir <span style="color:#f92672">=</span> set(), set()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_fileDistribute</span>(path_):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>            fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.md&#39;</span>:
</span></span><span style="display:flex;"><span>                fname_md<span style="color:#f92672">.</span>add(fname)
</span></span><span style="display:flex;"><span>                move_md_(file, contentPath)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.png&#39;</span>:
</span></span><span style="display:flex;"><span>                move_md_(file, imgPath, path_)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> ext <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>                fname_dir<span style="color:#f92672">.</span>add(fname)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                remove(path<span style="color:#f92672">.</span>join(path_, file))
</span></span><span style="display:flex;"><span>    _fileDistribute(path_)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mdImgDir <span style="color:#f92672">=</span> fname_dir <span style="color:#f92672">&amp;</span> fname_md
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> fname_md <span style="color:#f92672">in</span> mdImgDir:
</span></span><span style="display:flex;"><span>        _fileDistribute(path<span style="color:#f92672">.</span>join(path_, fname_md))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    shutil<span style="color:#f92672">.</span>rmtree(sourcePath)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">organizeNotionExportFile</span>(path_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>        fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ext <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;.md&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>]:
</span></span><span style="display:flex;"><span>            remove(path<span style="color:#f92672">.</span>join(path_, file))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> ext <span style="color:#f92672">and</span> fname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.md&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>            shutil<span style="color:#f92672">.</span>rmtree(path<span style="color:#f92672">.</span>join(path_, fname))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(fname<span style="color:#f92672">.</span>split()[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        new_file <span style="color:#f92672">=</span> fname <span style="color:#f92672">+</span> ext
</span></span><span style="display:flex;"><span>        rename(path<span style="color:#f92672">.</span>join(path_,file), path<span style="color:#f92672">.</span>join(path_, new_file))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> listdir(path_)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">updateImageFileName</span>(path_):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_updateImageFileName</span>(path_, folder_name):
</span></span><span style="display:flex;"><span>        path_ <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>join(path_, folder_name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, img <span style="color:#f92672">in</span> enumerate(listdir(path_)):
</span></span><span style="display:flex;"><span>            rename(path<span style="color:#f92672">.</span>join(path_, img), path<span style="color:#f92672">.</span>join(path_, folder_name <span style="color:#f92672">+</span> str(i) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>))
</span></span><span style="display:flex;"><span>        logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> Images Name Changed] </span><span style="color:#e6db74">{</span>img<span style="color:#e6db74">}</span><span style="color:#e6db74"> -&gt; </span><span style="color:#e6db74">{</span>folder_name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>isdir(path<span style="color:#f92672">.</span>join(path_, file)):
</span></span><span style="display:flex;"><span>            _updateImageFileName(path_, file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cleanFileNames</span>(path_):
</span></span><span style="display:flex;"><span>    pattern <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;[^\w\d_]+&#39;</span>)
</span></span><span style="display:flex;"><span>    renameCount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> listdir(path_):
</span></span><span style="display:flex;"><span>        fname, ext <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>        fname <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(pattern, <span style="color:#e6db74">&#39;_&#39;</span>, fname)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> fname<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;_&#39;</span>):
</span></span><span style="display:flex;"><span>            fname <span style="color:#f92672">=</span> fname<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;_&#39;</span>)
</span></span><span style="display:flex;"><span>        rename(path<span style="color:#f92672">.</span>join(path_, file), path<span style="color:#f92672">.</span>join(path_, fname <span style="color:#f92672">+</span> ext))
</span></span><span style="display:flex;"><span>        renameCount <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>renameCount<span style="color:#e6db74">}</span><span style="color:#e6db74"> files name successfully changed]&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> renameCount
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">updatePostContent</span>(path_):
</span></span><span style="display:flex;"><span>    mdList <span style="color:#f92672">=</span> [mdFile <span style="color:#66d9ef">for</span> mdFile <span style="color:#f92672">in</span> listdir(path_) <span style="color:#66d9ef">if</span> mdFile<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;.md&#39;</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> mdList:
</span></span><span style="display:flex;"><span>        fname, _ <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>splitext(file)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> path<span style="color:#f92672">.</span>isdir(path<span style="color:#f92672">.</span>join(path_,fname)):
</span></span><span style="display:flex;"><span>            imgList <span style="color:#f92672">=</span> [imgFile <span style="color:#66d9ef">for</span> imgFile <span style="color:#f92672">in</span> listdir(path<span style="color:#f92672">.</span>join(path_,fname))]
</span></span><span style="display:flex;"><span>            print(imgList)
</span></span><span style="display:flex;"><span>            imgIdx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        FrontMatterClosed <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> fileinput<span style="color:#f92672">.</span>FileInput(path<span style="color:#f92672">.</span>join(path_,file),inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>            insideOfLatexBlock <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            paramCheck <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;categories&#39;</span>:<span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;tags&#39;</span>:<span style="color:#66d9ef">False</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> f:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># frontmatter 생성</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> f<span style="color:#f92672">.</span>isfirstline():
</span></span><span style="display:flex;"><span>                    title <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74">&#39;#&#39;</span>)
</span></span><span style="display:flex;"><span>                    titleParam <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;title:&#39;</span> <span style="color:#f92672">+</span> title
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">&#39;---&#39;</span>)
</span></span><span style="display:flex;"><span>                    line <span style="color:#f92672">=</span> titleParam
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> FrontMatterClosed:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> line <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">elif</span> f<span style="color:#f92672">.</span>lineno() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>                        FrontMatterClosed <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                        print(<span style="color:#e6db74">&#39;type: post&#39;</span>)
</span></span><span style="display:flex;"><span>                        print(<span style="color:#e6db74">&#39;---&#39;</span>)
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> paramCheck:
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> paramCheck[p]:
</span></span><span style="display:flex;"><span>                                logging<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">] The [</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">] parameter does not exist in the frontmatter of the post.&#39;</span>)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># 노션 DB에 존재하는 column들</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">elif</span> line<span style="color:#f92672">.</span>startswith((<span style="color:#e6db74">&#39;마지막 학습일:&#39;</span>, <span style="color:#e6db74">&#39;status:&#39;</span>, <span style="color:#e6db74">&#39;갱신:&#39;</span>, 
</span></span><span style="display:flex;"><span>                                          <span style="color:#e6db74">&#39;summary:&#39;</span>, <span style="color:#e6db74">&#39;생성일:&#39;</span>, <span style="color:#e6db74">&#39;생성일0:&#39;</span>, 
</span></span><span style="display:flex;"><span>                                          <span style="color:#e6db74">&#39;하위 항목:&#39;</span>, <span style="color:#e6db74">&#39;상위 항목:&#39;</span>, <span style="color:#e6db74">&#39;이웃 항목:&#39;</span>)):
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># 나는 편의를 위해 노션 DB에 categories, tags column을 만들어두었다.</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">elif</span> line<span style="color:#f92672">.</span>startswith((<span style="color:#e6db74">&#39;categories:&#39;</span>, <span style="color:#e6db74">&#39;tags:&#39;</span>)):
</span></span><span style="display:flex;"><span>                        param, values <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;:&#39;</span>)
</span></span><span style="display:flex;"><span>                        values <span style="color:#f92672">=</span> values<span style="color:#f92672">.</span>lstrip()<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                        line <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>param<span style="color:#e6db74">}</span><span style="color:#e6db74">: [</span><span style="color:#e6db74">{</span>values<span style="color:#e6db74">}</span><span style="color:#e6db74">]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 수식 오류 발생 시 로깅하기</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;⁍&#39;</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>                    logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;[</span><span style="color:#e6db74">{</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74">] </span><span style="color:#e6db74">{</span>f<span style="color:#f92672">.</span>lineno()<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">th line latex syntax error occured.&#39;</span>)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># image path 재설정하기</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;![Untitled](&#39;</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>                    indent_ <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;![Untitled]&#39;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>                    line <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>indent_<span style="color:#e6db74">}</span><span style="color:#e6db74">![</span><span style="color:#e6db74">{</span>fname<span style="color:#e6db74">}</span><span style="color:#e6db74">](/imgs/</span><span style="color:#e6db74">{</span>imgList[imgIdx]<span style="color:#e6db74">}</span><span style="color:#e6db74">)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                    imgIdx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># hugo에서 latex 인식 가능하도록 latex 구문 변경하기</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 들여쓰기때문에 line 길이로 인식하면 안됨.</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;$$&#39;</span> <span style="color:#f92672">in</span> line <span style="color:#f92672">and</span> len(line<span style="color:#f92672">.</span>lstrip()) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">3</span>: <span style="color:#75715e"># 블럭 수식</span>
</span></span><span style="display:flex;"><span>                    indent_ <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;$$&#39;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> insideOfLatexBlock:
</span></span><span style="display:flex;"><span>                        line <span style="color:#f92672">=</span> indent_ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;`$$</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                        insideOfLatexBlock <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                        line <span style="color:#f92672">=</span> indent_ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;$$`</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                        insideOfLatexBlock <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 수식이 끝나자마자 시작하는 경우 때문에 `$$`가 없다를 예외 조건으로 추가하면 안됨.</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;$&#39;</span> <span style="color:#f92672">in</span> line <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;`$&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> line <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;$`&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> line: <span style="color:#75715e"># 인라인 수식</span>
</span></span><span style="display:flex;"><span>                    tokens <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;$&#39;</span>)
</span></span><span style="display:flex;"><span>                    insideOfLatexInline <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> len(tokens) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>: <span style="color:#75715e"># token들이 하나의 문장으로 합쳐질 때까지 반복.</span>
</span></span><span style="display:flex;"><span>                        right_, left_ <span style="color:#f92672">=</span> tokens<span style="color:#f92672">.</span>pop(), tokens<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> insideOfLatexInline:
</span></span><span style="display:flex;"><span>                            tokens<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>left_<span style="color:#e6db74">}</span><span style="color:#e6db74">$`</span><span style="color:#e6db74">{</span>right_<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                            insideOfLatexInline <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                            tokens<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>left_<span style="color:#e6db74">}</span><span style="color:#e6db74">`$</span><span style="color:#e6db74">{</span>right_<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                            insideOfLatexInline <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>                    line <span style="color:#f92672">=</span> tokens<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>                print(line, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>a <span style="color:#f92672">or</span> <span style="color:#f92672">not</span> args<span style="color:#f92672">.</span>d:
</span></span><span style="display:flex;"><span>        extractZip(downloadPath)
</span></span><span style="display:flex;"><span>        organizeNotionExportFile(sourcePath)
</span></span><span style="display:flex;"><span>        cleanFileNames(sourcePath)
</span></span><span style="display:flex;"><span>        updateImageFileName(sourcePath)
</span></span><span style="display:flex;"><span>        updatePostContent(sourcePath)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>a <span style="color:#f92672">or</span> args<span style="color:#f92672">.</span>d:
</span></span><span style="display:flex;"><span>        fileDistribute(sourcePath)
</span></span></code></pre></div><p>사용 방법은 다음과 같다.</p>
<h2 id="사용-방법">사용 방법</h2>
<ol>
<li>
<p>블로그로 옮기고자 하는 노션 페이지에서 우측 상단의  <code>$\cdots$</code>을 누른다.</p>
<p><img src="/imgs/Notion2Hugo_blog_%E1%84%8C%E1%85%A1%E1%84%83%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA0.png" alt="자동화"></p>
</li>
<li>
<p>내보내기를 누르고, 아래 이미지처럼 설정한 후 내보내기 버튼을 클릭한다.</p>
<p><img src="/imgs/Notion2Hugo_blog_%E1%84%8C%E1%85%A1%E1%84%83%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA1.png" alt="자동화"></p>
</li>
<li>
<p>default로 download 폴더에 저장되기 때문에, 경로나 파일명을 변경할 필요 없이 그대로 저장한다.</p>
</li>
<li>
<p>post_upload코드를 동작시킨다.</p>
</li>
<li>
<p>다운로드 폴더의 압축 파일을 정리한다.</p>
</li>
</ol>
<hr>
<h2 id="남은-할-일">남은 할 일</h2>
<ul>
<li>파일 이동시키기 예외 처리 — 기존에 동일한 이름의 포스팅이 존재하는 경우</li>
<li>updatePostContent 함수 기능 단위로 구분하기</li>
<li>다양한 예외 처리하기</li>
</ul>
<h2 id="글을-마무리하며">글을 마무리하며</h2>
<p>나는 사실 단축키를 정말 좋아하고, 단순 반복 작업을 싫어하기 때문에 이때까지 이런 작업을 종종 했다. 이런 작업들은 취미에 가깝다고 생각하여 굳이 정리해두진 않았다만…</p>
<p>노션 자동화의 경우 나름 필요한 사람이 꽤 있을 것 같아 블로그에 업로드한다.</p>
<p>나는 사실 이 글 또한 자동화 코드로 올릴 예정이었는데, 동작 코드 자체를 설명하다 보니 예외적인 latex 수식이 너무 많아 제대로 동작할 것이라는 자신이 없다. 그래도 시도해보겠다.</p>
<p>일단 임시로 첫 버전을 업로드했다. 다음 번에는 기능도 추가하고, 코드도 다듬은 다음 버저닝 방법을 좀 더 공부하여 새롭게 공유하겠다.</p>

        </p>
        
    </div>

    <div class="prev-next">
        
    </div>

    
    
    <svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top">
        
        <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/>
    </svg>
    
    <script>
        let backToTopButton = document.getElementById("btt-button");

        window.onscroll = function() {
            scrollFunction()
        };

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        }

        function topFunction() {
            smoothScrollToTop();
        }

        function smoothScrollToTop() {
            const scrollToTop = () => {
                const c = document.documentElement.scrollTop || document.body.scrollTop;
                if (c > 0) {
                    window.requestAnimationFrame(scrollToTop);
                    window.scrollTo(0, c - c / 8);
                }
            };
            scrollToTop();
        }
    </script>
    
    
    <div id="tex">
        <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script> 
    </div>
    
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#구현-과정">구현 과정</a></li>
        <li><a href="#코드">코드</a>
          <ul>
            <li><a href="#1-노션-압축-파일-목록-생성하기">1. 노션 압축 파일 목록 생성하기</a></li>
            <li><a href="#2-압축-풀기">2. 압축 풀기</a></li>
            <li><a href="#3-압축-푼-파일-이름-다른-형식ex-pdf-파일-제거하기">3. 압축 푼 파일 이름, 다른 형식(ex. pdf) 파일 제거하기</a></li>
            <li><a href="#4-파일명-기분-좋게-수정하기">4. 파일명 기분 좋게(?) 수정하기</a></li>
            <li><a href="#5-이미지-파일-이름-수정하기">5. 이미지 파일 이름 수정하기</a></li>
            <li><a href="#6-페이지-내부-작업">6. 페이지 내부 작업</a></li>
            <li><a href="#7-파일-이동시키기">7. 파일 이동시키기</a></li>
            <li><a href="#전체-코드">전체 코드</a></li>
          </ul>
        </li>
        <li><a href="#사용-방법">사용 방법</a></li>
        <li><a href="#남은-할-일">남은 할 일</a></li>
        <li><a href="#글을-마무리하며">글을 마무리하며</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>


    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2024 OMIN</span>
    
</footer>
</body>
</html>
